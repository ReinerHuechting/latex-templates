\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{framesections}[2022/05/01 Frame Sections]
\RequirePackage{xparse}
\RequirePackage{xifthen}

\def\@nosframetitlewarning{\alert{Warning: No title for frame section}}

% Define commands for this package if no options are given.
\def\insertframesection{}
\def\debugframesectiontitle{}

% Define package options.
\DeclareOption{draft}{
  \def\insertframesection{\@nosframetitlewarning}
  \def\debugframesectiontitle{Current framesection title: \insertframesection}
}
\ProcessOptions\relax

\newcounter{framesectiondepth}
\setcounter{framesectiondepth}{0}

% Environment for a series of frames with a common title.
% #1: Common title for all frames in this series
\newenvironment{framesection}[1]{
  \stepcounter{framesectiondepth}
  \def\insertframesection{#1}
}{
  \addtocounter{framesectiondepth}{-1}
}

% Environment for a frame that uses the current framesection title.
\NewDocumentEnvironment{sframe}{b}{
  \ifthenelse{\value{framesectiondepth}=0}{
    \PackageWarning{framesections}{
      sframe outside of a framesection. The frame will not have a valid title.}
  }{
  }
}{
  \begin{frame}{\insertframesection}
    #1
  \end{frame}
}

% TODO: Collect all warnings and summarize them in the end?
%       That might simplify development.
% TODO: Create a separate package for defining and using debug output.